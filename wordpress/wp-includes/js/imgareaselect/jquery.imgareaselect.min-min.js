!function(Se){function ze(){return Se("<div/>")}var ke=Math.abs,Ce=Math.max,Ae=Math.min,We=Math.round;Se.imgAreaSelect=function(o,n){function t(e){return e+le.left-he.left}function i(e){return e+le.top-he.top}function r(e){return e-le.left+he.left}function c(e){return e-le.top+he.top}function s(e){return Ce(e.pageX||0,a(e).x)-he.left}function d(e){return Ce(e.pageY||0,a(e).y)-he.top}function a(e){var t=e.originalEvent||{};return t.touches&&t.touches.length?{x:t.touches[0].pageX,y:t.touches[0].pageY}:{x:0,y:0}}function u(e){var t=e||D,o=e||R;return{x1:We(pe.x1*t),y1:We(pe.y1*o),x2:We(pe.x2*t),y2:We(pe.y2*o),width:We(pe.x2*t)-We(pe.x1*t),height:We(pe.y2*o)-We(pe.y1*o)}}function l(e,t,o,i,s){var n=s||D,r=s||R;(pe={x1:We(e/n||0),y1:We(t/r||0),x2:We(o/n||0),y2:We(i/r||0)}).width=pe.x2-pe.x1,pe.height=pe.y2-pe.y1}function h(){P&&ne.width()&&(le={left:We(ne.offset().left),top:We(ne.offset().top)},E=ne.innerWidth(),O=ne.innerHeight(),le.top+=ne.outerHeight()-O>>1,le.left+=ne.outerWidth()-E>>1,Y=We(n.minWidth/D)||0,$=We(n.minHeight/R)||0,q=We(Ae(n.maxWidth/D||1<<24,E)),B=We(Ae(n.maxHeight/R||1<<24,O)),"1.3.2"!=Se().jquery||"fixed"!=me||ye.getBoundingClientRect||(le.top+=Ce(document.body.scrollTop,ye.scrollTop),le.left+=Ce(document.body.scrollLeft,ye.scrollLeft)),he=/absolute|relative/.test(T.css("position"))?{left:We(T.offset().left)-T.scrollLeft(),top:We(T.offset().top)-T.scrollTop()}:"fixed"==me?{left:Se(document).scrollLeft(),top:Se(document).scrollTop()}:{left:0,top:0},H=t(0),M=i(0),(pe.x2>E||pe.y2>O)&&x())}function f(e){if(F){switch(re.css({left:t(pe.x1),top:i(pe.y1)}).add(ce).width(oe=pe.width).height(ie=pe.height),ce.add(de).add(ue).css({left:0,top:0}),de.width(Ce(oe-de.outerWidth()+de.innerWidth(),0)).height(Ce(ie-de.outerHeight()+de.innerHeight(),0)),Se(ae[0]).css({left:H,top:M,width:pe.x1,height:O}),Se(ae[1]).css({left:H+pe.x1,top:M,width:oe,height:pe.y1}),Se(ae[2]).css({left:H+pe.x2,top:M,width:E-pe.x2,height:O}),Se(ae[3]).css({left:H+pe.x1,top:M+pe.y2,width:oe,height:O-pe.y2}),oe-=ue.outerWidth(),ie-=ue.outerHeight(),ue.length){case 8:Se(ue[4]).css({left:oe>>1}),Se(ue[5]).css({left:oe,top:ie>>1}),Se(ue[6]).css({left:oe>>1,top:ie}),Se(ue[7]).css({top:ie>>1});case 4:ue.slice(1,3).css({left:oe}),ue.slice(2,4).css({top:ie})}!1!==e&&(Se.imgAreaSelect.onKeyPress!=ve&&Se(document).unbind(Se.imgAreaSelect.keyPress,Se.imgAreaSelect.onKeyPress),n.keys&&Se(document)[Se.imgAreaSelect.keyPress](Se.imgAreaSelect.onKeyPress=ve)),be&&de.outerWidth()-de.innerWidth()==2&&(de.css("margin",0),setTimeout(function(){de.css("margin","auto")},0))}}function m(e){h(),f(e),G=t(pe.x1),J=i(pe.y1),U=t(pe.x2),V=i(pe.y2)}function p(e,t){n.fadeSpeed?e.fadeOut(n.fadeSpeed,t):e.hide()}function y(e){var t=r(s(e))-pe.x1,o=c(d(e))-pe.y1;se||(h(),se=!0,re.one("mouseout",function(){se=!1})),X="",n.resizable&&(o<=n.resizeMargin?X="n":o>=pe.height-n.resizeMargin&&(X="s"),t<=n.resizeMargin?X+="w":t>=pe.width-n.resizeMargin&&(X+="e")),re.css("cursor",X?X+"-resize":n.movable?"move":""),N&&N.toggle()}function g(e){Se("body").css("cursor",""),(n.autoHide||pe.width*pe.height==0)&&p(re.add(ae),function(){Se(this).hide()}),Se(document).off("mousemove touchmove",w),re.on("mousemove touchmove",y),n.onSelectEnd(o,u())}function v(e){return("mousedown"!=e.type||1==e.which)&&(y(e),h(),X?(Se("body").css("cursor",X+"-resize"),G=t(pe[/w/.test(X)?"x2":"x1"]),J=i(pe[/n/.test(X)?"y2":"y1"]),Se(document).on("mousemove touchmove",w).one("mouseup touchend",g),re.off("mousemove touchmove",y)):n.movable?(L=H+pe.x1-s(e),j=M+pe.y1-d(e),re.off("mousemove touchmove",y),Se(document).on("mousemove touchmove",z).one("mouseup touchend",function(){n.onSelectEnd(o,u()),Se(document).off("mousemove touchmove",z),re.on("mousemove touchmove",y)})):ne.mousedown(e),!1)}function b(e){Q&&(e?(U=Ce(H,Ae(H+E,G+ke(V-J)*Q*(G<U||-1))),V=We(Ce(M,Ae(M+O,J+ke(U-G)/Q*(J<V||-1)))),U=We(U)):(V=Ce(M,Ae(M+O,J+ke(U-G)/Q*(J<V||-1))),U=We(Ce(H,Ae(H+E,G+ke(V-J)*Q*(G<U||-1)))),V=We(V)))}function x(){G=Ae(G,H+E),J=Ae(J,M+O),ke(U-G)<Y&&((U=G-Y*(U<G||-1))<H?G=H+Y:H+E<U&&(G=H+E-Y)),ke(V-J)<$&&((V=J-$*(V<J||-1))<M?J=M+$:M+O<V&&(J=M+O-$)),U=Ce(H,Ae(U,H+E)),V=Ce(M,Ae(V,M+O)),b(ke(U-G)<ke(V-J)*Q),ke(U-G)>q&&(U=G-q*(U<G||-1),b()),ke(V-J)>B&&(V=J-B*(V<J||-1),b(!0)),pe={x1:r(Ae(G,U)),x2:r(Ce(G,U)),y1:c(Ae(J,V)),y2:c(Ce(J,V)),width:ke(U-G),height:ke(V-J)},f(),n.onSelectChange(o,u())}function w(e){return U=/w|e|^$/.test(X)||Q?s(e):t(pe.x2),V=/n|s|^$/.test(X)||Q?d(e):i(pe.y2),x(),!1}function S(e,t){U=(G=e)+pe.width,V=(J=t)+pe.height,Se.extend(pe,{x1:r(G),y1:c(J),x2:r(U),y2:c(V)}),f(),n.onSelectChange(o,u())}function z(e){return G=Ce(H,Ae(L+s(e),H+E-pe.width)),J=Ce(M,Ae(j+d(e),M+O-pe.height)),S(G,J),e.preventDefault(),!1}function k(){Se(document).off("mousemove touchmove",k),h(),U=G,V=J,x(),X="",ae.is(":visible")||re.add(ae).hide().fadeIn(n.fadeSpeed||0),F=!0,Se(document).off("mouseup touchend",C).on("mousemove touchmove",w).one("mouseup touchend",g),re.off("mousemove touchmove",y),n.onSelectStart(o,u())}function C(){Se(document).off("mousemove touchmove",k).off("mouseup touchend",C),p(re.add(ae)),l(r(G),c(J),r(G),c(J)),this instanceof Se.imgAreaSelect||(n.onSelectChange(o,u()),n.onSelectEnd(o,u()))}function A(e){return!(1<e.which||ae.is(":animated")||(h(),L=G=s(e),j=J=d(e),Se(document).on({"mousemove touchmove":k,"mouseup touchend":C}),1))}function W(){m(!1)}function e(){P=!0,K(n=Se.extend({classPrefix:"imgareaselect",movable:!0,parent:"body",resizable:!0,resizeMargin:10,onInit:function(){},onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}},n)),re.add(ae).css({visibility:""}),n.show&&(F=!0,h(),f(),re.add(ae).hide().fadeIn(n.fadeSpeed||0)),setTimeout(function(){n.onInit(o,u())},0)}function I(e,t){for(var o in t)void 0!==n[o]&&e.css(t[o],n[o])}function K(e){if(e.parent&&(T=Se(e.parent)).append(re.add(ae)),Se.extend(n,e),h(),null!=e.handles){for(ue.remove(),ue=Se([]),ee=e.handles?"corners"==e.handles?4:8:0;ee--;)ue=ue.add(ze());ue.addClass(n.classPrefix+"-handle").css({position:"absolute",fontSize:0,zIndex:fe+1||1}),0<=!parseInt(ue.css("width"))&&ue.width(5).height(5),(te=n.borderWidth)&&ue.css({borderWidth:te,borderStyle:"solid"}),I(ue,{borderColor1:"border-color",borderColor2:"background-color",borderOpacity:"opacity"})}for(D=n.imageWidth/E||1,R=n.imageHeight/O||1,null!=e.x1&&(l(e.x1,e.y1,e.x2,e.y2),e.show=!e.hide),e.keys&&(n.keys=Se.extend({shift:1,ctrl:"resize"},e.keys)),ae.addClass(n.classPrefix+"-outer"),ce.addClass(n.classPrefix+"-selection"),ee=0;ee++<4;)Se(de[ee-1]).addClass(n.classPrefix+"-border"+ee);I(ce,{selectionColor:"background-color",selectionOpacity:"opacity"}),I(de,{borderOpacity:"opacity",borderWidth:"border-width"}),I(ae,{outerColor:"background-color",outerOpacity:"opacity"}),(te=n.borderColor1)&&Se(de[0]).css({borderStyle:"solid",borderColor:te}),(te=n.borderColor2)&&Se(de[1]).css({borderStyle:"dashed",borderColor:te}),re.append(ce.add(de).add(N)).append(ue),be&&((te=(ae.css("filter")||"").match(/opacity=(\d+)/))&&ae.css("opacity",te[1]/100),(te=(de.css("filter")||"").match(/opacity=(\d+)/))&&de.css("opacity",te[1]/100)),e.hide?p(re.add(ae)):e.show&&P&&(F=!0,re.add(ae).fadeIn(n.fadeSpeed||0),m()),Q=(_=(n.aspectRatio||"").split(/:/))[0]/_[1],ne.add(ae).unbind("mousedown",A),n.disable||!1===n.enable?(re.off({"mousemove touchmove":y,"mousedown touchstart":v}),Se(window).off("resize",W)):((n.enable||!1===n.disable)&&((n.resizable||n.movable)&&re.on({"mousemove touchmove":y,"mousedown touchstart":v}),Se(window).resize(W)),n.persistent||ne.add(ae).on("mousedown touchstart",A)),n.enable=n.disable=void 0}var P,N,H,M,E,O,T,L,j,D,R,X,Y,$,q,B,Q,F,G,J,U,V,Z,_,ee,te,oe,ie,se,ne=Se(o),re=ze(),ce=ze(),de=ze().add(ze()).add(ze()).add(ze()),ae=ze().add(ze()).add(ze()).add(ze()),ue=Se([]),le={left:0,top:0},he={left:0,top:0},fe=0,me="absolute",pe={x1:0,y1:0,x2:0,y2:0,width:0,height:0},ye=document.documentElement,ge=navigator.userAgent,ve=function(e){var t,o,i=n.keys,s=e.keyCode;if(t=isNaN(i.alt)||!e.altKey&&!e.originalEvent.altKey?!isNaN(i.ctrl)&&e.ctrlKey?i.ctrl:!isNaN(i.shift)&&e.shiftKey?i.shift:isNaN(i.arrows)?10:i.arrows:i.alt,"resize"==i.arrows||"resize"==i.shift&&e.shiftKey||"resize"==i.ctrl&&e.ctrlKey||"resize"==i.alt&&(e.altKey||e.originalEvent.altKey)){switch(s){case 37:t=-t;case 39:o=Ce(G,U),G=Ae(G,U),U=Ce(o+t,G),b();break;case 38:t=-t;case 40:o=Ce(J,V),J=Ae(J,V),V=Ce(o+t,J),b(!0);break;default:return}x()}else switch(G=Ae(G,U),J=Ae(J,V),s){case 37:S(Ce(G-t,H),J);break;case 38:S(G,Ce(J-t,M));break;case 39:S(G+Ae(t,E-r(U)),J);break;case 40:S(G,J+Ae(t,O-c(V)));break;default:return}return!1};this.remove=function(){K({disable:!0}),re.add(ae).remove()},this.getOptions=function(){return n},this.setOptions=K,this.getSelection=u,this.setSelection=l,this.cancelSelection=C,this.update=m;var be=(/msie ([\w.]+)/i.exec(ge)||[])[1],xe=/opera/i.test(ge),we=/webkit/i.test(ge)&&!/chrome/i.test(ge);for(Z=ne;Z.length;)fe=Ce(fe,isNaN(Z.css("z-index"))?fe:Z.css("z-index")),"fixed"==Z.css("position")&&(me="fixed"),Z=Z.parent(":not(body)");fe=n.zIndex||fe,be&&ne.attr("unselectable","on"),Se.imgAreaSelect.keyPress=be||we?"keydown":"keypress",xe&&(N=ze().css({width:"100%",height:"100%",position:"absolute",zIndex:fe+2||2})),re.add(ae).css({visibility:"hidden",position:me,overflow:"hidden",zIndex:fe||"0"}),re.css({zIndex:fe+2||2}),ce.add(de).css({position:"absolute",fontSize:0}),o.complete||"complete"==o.readyState||!ne.is("img")?e():ne.one("load",e),!P&&be&&7<=be&&(o.src=o.src)},Se.fn.imgAreaSelect=function(e){return e=e||{},this.each(function(){Se(this).data("imgAreaSelect")?e.remove?(Se(this).data("imgAreaSelect").remove(),Se(this).removeData("imgAreaSelect")):Se(this).data("imgAreaSelect").setOptions(e):e.remove||(void 0===e.enable&&void 0===e.disable&&(e.enable=!0),Se(this).data("imgAreaSelect",new Se.imgAreaSelect(this,e)))}),e.instance?Se(this).data("imgAreaSelect"):this}}(jQuery);